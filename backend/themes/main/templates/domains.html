<script type="text/x-template" id="domains-template">
    <v-container fluid>
        <h2>Domains</h2>
        <v-data-table
                :headers="headers"
                :items="domains"
                :loading="loadingDomains"
                hide-default-header
                hide-default-footer
                dense
                class="elevation-1 mt-4"
        ></v-data-table>
    </v-container>
</script>

<script type="application/javascript">
    Vue.component('domains-component', {
        template: '#domains-template',
        data() {
            return {
                newDomain: '',
                loadingDomains: false,
                domains: [
                    {
                        id: 1,
                        domain: "example.com",
                        redirect_https: true,
                        handle_404: "error",
                        default_company: "Company A",
                        group_name: "Group 1",
                        status: "ok",
                        created_at: "2025-04-26T21:30:00",
                        updated_at: "2025-04-26T21:40:00",
                    },
                    {
                        id: 2,
                        domain: "test.com",
                        redirect_https: false,
                        handle_404: "redirect_to_company",
                        default_company: "Company B",
                        group_name: "Group 2",
                        status: "pending",
                        created_at: "2025-04-25T20:20:00",
                        updated_at: "2025-04-25T20:25:00",
                    },
                ],
                headers: [
                    {text: 'ID', value: 'id'},
                    {text: 'Domain', value: 'domain'},
                    {text: 'Redirect HTTPS', value: 'redirect_https'},
                    {text: 'Handle 404', value: 'handle_404'},
                    {text: 'Default Company', value: 'default_company'},
                    {text: 'Group Name', value: 'group_name'},
                    {text: 'Status', value: 'status'},
                    {text: 'Created At', value: 'created_at'},
                    {text: 'Updated At', value: 'updated_at'},
                ],
            };
        },
        mounted() {
            this.loadDomains();
            this.$root.$on('load-domains', this.loadDomains);
        },
        methods: {
            async loadDomains() {
                try {
                    this.loadingDomains = true;
                    const response = await fetch('/backend/api/domains/', {
                        credentials: 'include'
                    });

                    if (!response.ok) {
                        throw new Error('Failed to fetch domains');
                    }

                    this.domains = await response.json();
                    this.loadingDomains = false;
                } catch (error) {
                    console.error('Error loading domains:', error);
                }
            },
            async addDomain() {
                if (!this.newDomain.trim()) return;
                await fetch('/backend/api/domains/', {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({domain: this.newDomain.trim()}),
                    credentials: 'include'
                });
                this.newDomain = '';
                this.loadDomains();
            }
        }
    });

</script>
