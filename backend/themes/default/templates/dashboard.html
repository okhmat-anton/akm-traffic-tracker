{% raw %}
<script type="text/x-template" id="dashboard-template">
    <v-container fluid>
        <h2>Dashboard</h2>

        <v-row dense class="mt-4">
            <v-col
                    v-for="metric in metrics"
                    :key="metric.title"
                    cols="12"
                    sm="6"
                    md="2"
            >
                <v-card class="pa-3"
                        :color="metric.color"
                >
                    <v-card-text class="text-center">
                        <div class="text-h5">{{ metric.title }}</div>
                        <div class="text-h3 font-weight-bold mt-2">{{ metric.value }}</div>
                    </v-card-text>
                </v-card>
            </v-col>
        </v-row>
        <v-row class="mt-4">
            <v-col></v-col>
            <v-col cols="2">
                <v-menu
                        v-model="date_menu2"
                        :close-on-content-click="false"
                        :nudge-right="40"
                        transition="scale-transition"
                        offset-y
                        min-width="auto"
                >
                    <template v-slot:activator="{ on, attrs }">
                        <v-text-field
                                v-model="dateRangeText"
                                label="Date range"
                                prepend-icon="mdi-calendar"
                                readonly
                                v-bind="attrs"
                                v-on="on"
                                range
                                readonly
                                outlined
                                dense
                        ></v-text-field>
                    </template>
                    <v-date-picker
                            v-model="date_range"
                            @input="menu2 = false"
                            range
                    ></v-date-picker>
                </v-menu>
            </v-col>
            <v-col cols="2">
                <v-select
                        :items="['Hours', 'Days', 'Weeks', 'Months']"
                        label="Detalization"
                        v-model="detailLevel"
                        outlined
                        dense
                ></v-select>
            </v-col>
        </v-row>
        <v-row>
            <v-col cols="12">
                <v-card>
                    <apexchart
                            height="500"
                            type="area"
                            :options="mainChart.chartOptions"
                            :series="mainChart.series"
                    ></apexchart>
                </v-card>
            </v-col>
        </v-row>
        <v-row>
            <v-col cols="8">
                <v-card>
                    <v-data-table
                            :headers="headers"
                            :items="visits"
                            :items-per-page="5"
                            class="elevation-1"
                    ></v-data-table>
                </v-card>
            </v-col>
            <v-col cols="4">
                <v-card>
                    <v-data-table
                            :headers="headers2"
                            :items="visits"
                            :items-per-page="5"
                            class="elevation-1"
                    ></v-data-table>
                </v-card>
            </v-col>
        </v-row>
    </v-container>
</script>

<script type="application/javascript">
    Vue.component('dashboard-component', {
        template: '#dashboard-template',
        data() {
            return {
                date_menu2: false,
                date_range: ['2019-09-10', '2019-09-20'],
                metrics: [
                    {title: 'Clicks', value: 12345, color: 'blue darken-2'},
                    {title: 'Unique Clicks', value: 6789, color: 'indigo darken-2'},
                    {title: 'Conversions', value: 456, color: 'deep-purple darken-2'},
                    {title: 'Cost', value: '$1234', color: 'red darken-2'},
                    {title: 'Revenue', value: '$5678', color: 'green darken-2'},
                    {title: 'ROI', value: '120%', color: 'teal darken-2'}
                ],
                detailLevel: 'Days',
                mainChart: {
                    series: [
                        {
                            name: 'Clicks',
                            data: [10, 41, 35, 51, 49, 62, 69, 91, 148]
                        },
                        {
                            name: 'Conversions',
                            data: [2, 10, 8, 15, 12, 18, 20, 25, 30]
                        },
                        {
                            name: 'Unique Clicks',
                            data: [5, 20, 15, 30, 25, 35, 45, 60, 90]
                        },

                    ],
                    chartOptions: {
                        chart: {
                            background: 'None',
                            id: 'basic-line',
                            stacked: false,
                            toolbar: {
                                show: true
                            },
                            zoom: {
                                enabled: false
                            }
                        },
                        dataLabels: {
                            enabled: false
                        },
                        stroke: {
                            curve: 'monotoneCubic'
                        },
                        theme: {
                            mode: 'dark'
                        },
                        xaxis: {
                            categories: ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep'],
                            // type: 'datetime'
                        },
                        yaxis: {
                            labels: {
                                style: {
                                    colors: '#ffffff'
                                }
                            }
                        },
                        legend: {
                            position: 'top',
                            horizontalAlign: 'left'
                        },
                    }
                },
                headers: [
    { text: 'IP', value: 'ip' },
    { text: 'Country', value: 'country' },
    { text: 'Url', value: 'url' },
    { text: 'Referrer', value: 'referrer' },
    { text: 'Time', value: 'received_at' },
],
                headers2: [
    { text: 'IP', value: 'ip' },
    { text: 'Country', value: 'country' },
    { text: 'Referrer', value: 'referrer' },
    { text: 'Time', value: 'received_at' },
],
                visits: [],

            }
        },
        mounted() {
            this.loadData();
            this.$root.$on('load-dashboard', this.loadData);
        },

        computed: {
            dateRangeText() {
                return this.date_range.join(' ~ ')
            },
        },

        methods:
        {
            loadData(date) {
                fetch('/backend/api/dashboard/visits')
                    .then(res => res.json())
                    .then(data => {
                        this.visits = data;
                    });

                fetch('/backend/api/dashboard/metrics')
                  .then(res => res.json())
                  .then(data => {
                    this.metrics = [
                      { title: 'Clicks', value: data.metrics.clicks, color: 'blue darken-2' },
                      { title: 'Unique Clicks', value: data.metrics.unique_clicks, color: 'indigo darken-2' },
                      { title: 'Conversions', value: data.metrics.conversions, color: 'deep-purple darken-2' },
                      { title: 'Cost', value: `$${data.metrics.cost}`, color: 'red darken-2' },
                      { title: 'Revenue', value: `$${data.metrics.revenue}`, color: 'green darken-2' },
                      { title: 'ROI', value: data.metrics.roi, color: 'teal darken-2' }
                    ];

                    this.mainChart.chartOptions.xaxis.categories = data.chart.labels;
                    this.mainChart.series = [
                      { name: 'Clicks', data: data.chart.clicks },
                      { name: 'Conversions', data: data.chart.conversions },
                      { name: 'Unique Clicks', data: data.chart.unique_clicks }
                    ];
                  });

            },

        }
    });
</script>
{% endraw %}